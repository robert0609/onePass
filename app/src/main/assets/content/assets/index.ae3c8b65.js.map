{"version":3,"file":"index.ae3c8b65.js","sources":["../../src/pages/home/index.tsx"],"sourcesContent":["import { defineComponent, onMounted, ref } from 'vue';\nimport LayoutMain from '@/components/layoutMain';\nimport OneTable from '@/components/table';\nimport { siteListController } from '@/core/business/site';\nimport { ElMessage, ElLoading, ILoadingInstance } from 'element-plus';\nimport { useRoute, useRouter, onBeforeRouteUpdate } from 'vue-router';\nimport { Site } from '@/api';\nimport SiteEdit from '@/pages/site/edit';\nimport { isStringEmpty } from 'roy-type-assert';\n\nexport default defineComponent({\n  name: 'Home',\n  setup() {\n    const router = useRouter();\n    const route = useRoute();\n    let loadingInstance: ILoadingInstance | undefined;\n    const showEditApp = ref<boolean>(false);\n\n    const {\n      keyword,\n      siteList,\n      pageSize,\n      currentPageIndex,\n      totalCount,\n      fetchSiteList\n    } = siteListController();\n\n    const selectedSiteId = ref<number>(0);\n    const selectedLevel = ref<string>('');\n\n    onMounted(() => {\n      keyword.value = route.query.keyword as string;\n      if (isStringEmpty(keyword.value)) {\n        return;\n      }\n      loadSiteList();\n    });\n\n    onBeforeRouteUpdate((to, from, next) => {\n      keyword.value = to.query.keyword as string;\n      if (isStringEmpty(keyword.value)) {\n        return;\n      }\n      loadSiteList();\n      next();\n    });\n\n    function loadSiteList() {\n      loadingInstance = ElLoading.service({\n        target: '#site-table'\n      });\n      fetchSiteList()\n        .catch((e) => {\n          ElMessage.error(e.message);\n        })\n        .finally(() => {\n          if (loadingInstance) {\n            loadingInstance.close();\n          }\n        });\n    }\n\n    function onClickAccountList(row: Site) {\n      router.push({\n        name: 'accountList',\n        query: {\n          site_id: row.id\n        }\n      });\n    }\n\n    function onClickEditApp(row: Site) {\n      selectedSiteId.value = row.id;\n      selectedLevel.value = row.level;\n      showEditApp.value = true;\n    }\n\n    function onDrawConfirm() {\n      showEditApp.value = false;\n      loadSiteList();\n    }\n\n    return () => (\n      <>\n        <LayoutMain>\n          <OneTable\n            data={siteList.value}\n            pageSize={pageSize.value}\n            currentPageIndex={currentPageIndex.value}\n            totalCount={totalCount.value}\n            {...{\n              id: 'site-table',\n              height: '750px'\n            }}\n          >\n            <ElTableColumn prop=\"id\" label=\"应用编号\"></ElTableColumn>\n            <ElTableColumn prop=\"level\" label=\"应用级别\"></ElTableColumn>\n            <ElTableColumn prop=\"name\" label=\"应用名称\"></ElTableColumn>\n            <ElTableColumn prop=\"url\" label=\"应用地址\"></ElTableColumn>\n            <ElTableColumn\n              label=\"操作\"\n              v-slots={{\n                default: ({ row }: { row: Site }) => (\n                  <>\n                    <ElLink\n                      type=\"primary\"\n                      href=\"javascript:void(0);\"\n                      onClick={() => onClickEditApp(row)}\n                    >\n                      编辑\n                    </ElLink>\n                    <ElDivider direction=\"vertical\"></ElDivider>\n                    <ElLink\n                      type=\"primary\"\n                      href=\"javascript:void(0);\"\n                      onClick={() => onClickAccountList(row)}\n                    >\n                      账号列表\n                    </ElLink>\n                  </>\n                )\n              }}\n            ></ElTableColumn>\n          </OneTable>\n        </LayoutMain>\n        <ElDrawer\n          title=\"应用编辑\"\n          size=\"30%\"\n          {...{\n            modelValue: showEditApp.value,\n            ['onUpdate:modelValue']: (val: boolean) => (showEditApp.value = val)\n          }}\n        >\n          {showEditApp.value ? (\n            <SiteEdit\n              level={selectedLevel.value}\n              id={selectedSiteId.value}\n              onConfirm={onDrawConfirm}\n              onCancel={() => (showEditApp.value = false)}\n            />\n          ) : undefined}\n        </ElDrawer>\n      </>\n    );\n  }\n});\n"],"names":["setup","showEditApp","currentPageIndex","totalCount","fetchSiteList","keyword","ElMessage","close","value","id","height","onClickEditApp","_createVNode","modelValue","onDrawConfirm"],"mappings":"0TAYEA,kCAIQC,OAEA,2BAIJC,UACAC,WACAC,kEAOqB,yDAQrBC,QACkBA,wEAWlBD,aAEIE,+CAIkBC,0JAoBxB,8EAW2CC,iCAGjCC,yBACAC,+FAIkB,WAAc,6DACd,cAAa,6DACb,aAAY,uJAInB,UAGE,YAEUC,QAAcC,gKAQI,mJAc3CC,yFAMuBL,4BAEVM,GAJd,oCAnDP"}