import{a as v,A as g,U as f}from"./index.613def92.js";import{f as n,i as p,$ as b,a0 as B,d as C,W as U,G as A,F as h,c as u,Z as s,Y as w,a as S}from"./vendor.bb182ad9.js";async function L(a){var t;const e=await v.get("/webapi/search",a);if(!e.data.isSuccess)throw g.createApiError(e.data.message?e.data.message:(t=e.data.errorCode)==null?void 0:t.toString());return e.data}async function V(a){var t;const e=await v.get("/webapi/site/fetch",a);if(!e.data.isSuccess)throw g.createApiError(e.data.message?e.data.message:(t=e.data.errorCode)==null?void 0:t.toString());return e.data}async function y(a){var t;const e=await v.get("/webapi/site/fetch",a);if(!e.data.isSuccess)throw g.createApiError(e.data.message?e.data.message:(t=e.data.errorCode)==null?void 0:t.toString());return e.data}async function x(a){var r;const e=a.site,t=await v.post("/webapi/site/save",{site:JSON.stringify({Id:e.id,Name:encodeURIComponent(e.name),Url:e.url,Level:e.level})});if(!t.data.isSuccess)throw g.createApiError(t.data.message?t.data.message:(r=t.data.errorCode)==null?void 0:r.toString());return t.data}function P(){const a=n(0),e=n(""),t=n(""),r=n([]),m=n(0),o=n(0),c=n(1),i=n(0);async function E(){try{if(a.value>0){const l=await y({id:a.value});r.value=l.data,o.value=l.data.length,i.value=l.data.length}else if(p(e.value)){if(p(t.value))throw f.createUIError("\u8BF7\u8BBE\u7F6E\u7B5B\u9009\u6761\u4EF6");{const l=await L({keyword:t.value,withaccount:!1});r.value=l.data,o.value=l.data.length,i.value=l.data.length}}else{const l=await V({level:e.value});r.value=l.data,o.value=l.data.length,i.value=l.data.length}}catch(l){throw r.value=[],m.value=0,o.value=0,i.value=0,l}}return{id:a,level:e,keyword:t,siteList:r,currentPageIndex:m,pageSize:o,totalPageCount:c,totalCount:i,fetchSiteList:E}}function k(){const a=b({id:0,name:"",url:"",level:""});async function e(){try{if(a.id>0){const r=await y({id:a.id});if(r.data.length>0)a.name=r.data[0].name,a.url=r.data[0].url,a.level=r.data[0].level;else throw f.createUIError("\u672A\u67E5\u8BE2\u5230\u7F51\u7AD9")}else throw f.createUIError("\u8BF7\u8BBE\u7F6E\u7F51\u7AD9id")}catch(r){throw a.name="",a.url="",a.level="",r}}async function t(){if(p(a.name))throw f.createUIError("\u8BF7\u8F93\u5165\u5E94\u7528\u540D\u79F0");if(a.level=a.level.toString(),p(a.level))throw f.createUIError("\u8BF7\u8F93\u5165\u5E94\u7528\u7EA7\u522B");try{await x({site:B(a)})}catch(r){throw r}}return{site:a,fetchSite:e,updateSite:t}}var D=C({name:"SiteEdit",props:{id:{type:Number,required:!0},level:{type:String,required:!0}},emits:["confirm","cancel"],setup(a,{emit:e}){const{site:t,fetchSite:r,updateSite:m}=k(),o=n(!1),c=n(null);let i;const E={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u5E94\u7528\u540D\u79F0",trigger:"blur"}]};function l(){c.value&&(o.value=!0,c.value.validate(d=>{d?m().then(()=>{e("confirm")}).catch(F=>{h.error(F.message)}).finally(()=>{o.value=!1}):o.value=!1}))}function I(){e("cancel")}return U(()=>{t.id=a.id,t.level=a.level,t.id>0&&(i=A.service({target:"#edit-form"}),r().catch(d=>{h.error(d.message)}).finally(()=>{i&&i.close()}))}),()=>u(s("ElForm"),w({model:t,ref:c,rules:E,labelPosition:"right",labelWidth:"90px"},{id:"edit-form"}),{default:()=>[u(s("ElFormItem"),{label:"\u5E94\u7528\u540D\u79F0",prop:"name"},{default:()=>[u(s("ElInput"),{modelValue:t.name,["onUpdate:modelValue"]:d=>t.name=d},null)]}),u(s("ElFormItem"),{label:"\u5E94\u7528\u5730\u5740",prop:"url"},{default:()=>[u(s("ElInput"),{modelValue:t.url,["onUpdate:modelValue"]:d=>t.url=d},null)]}),u(s("ElFormItem"),{label:"\u5E94\u7528\u7EA7\u522B",prop:"level"},{default:()=>[u(s("ElInput"),w({readonly:!0},{modelValue:t.level,["onUpdate:modelValue"]:d=>t.level=d}),null)]}),u(s("ElFormItem"),null,{default:()=>[u(s("ElButton"),{type:"primary",onClick:l,loading:o.value},{default:()=>[S("\u63D0\u4EA4")]}),u(s("ElButton"),{onClick:I},{default:()=>[S("\u53D6\u6D88")]})]})]})}}),_=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:D});export{D as S,_ as i,P as s};
//# sourceMappingURL=index.c83027f8.js.map
