import{a as m,A as p,U as f}from"./index.3fab5041.js";import{f as n,$ as y,i as w,a0 as F,d as b,W as N,F as h,c as o,Z as u,a as g}from"./vendor.bb182ad9.js";async function S(a){var t;const e=await m.get("/webapi/account/fetch",{siteid:a.siteId});if(!e.data.isSuccess)throw p.createApiError(e.data.message?e.data.message:(t=e.data.errorCode)==null?void 0:t.toString());return e.data}async function U(a){var t;const e=await m.get("/webapi/account/fetch",a);if(!e.data.isSuccess)throw p.createApiError(e.data.message?e.data.message:(t=e.data.errorCode)==null?void 0:t.toString());return e.data}async function B(a){var r;const e=a.account,t=await m.get("/webapi/account/save",{account:JSON.stringify({Id:e.id,SiteId:e.siteId,UserName:encodeURIComponent(e.userName),Password:e.password})});if(!t.data.isSuccess)throw p.createApiError(t.data.message?t.data.message:(r=t.data.errorCode)==null?void 0:r.toString());return t.data}function L(){const a=n(0),e=n([]),t=n(0),r=n(0),d=n(1),s=n(0);async function l(){try{if(a.value>0){const c=await S({siteId:a.value});e.value=c.data,r.value=c.data.length,s.value=c.data.length}else throw f.createUIError("\u6CA1\u6709\u4F20\u5165\u5E94\u7528\u7F16\u53F7\u6761\u4EF6")}catch(c){throw e.value=[],t.value=0,r.value=0,s.value=0,c}}return{siteId:a,accountList:e,currentPageIndex:t,pageSize:r,totalPageCount:d,totalCount:s,fetchAccountList:l}}function x(){const a=y({id:0,siteId:0,userName:"",password:""});async function e(){try{if(a.id>0){const r=await U({id:a.id});if(r.data.length>0)a.siteId=r.data[0].siteId,a.userName=r.data[0].userName,a.password=r.data[0].password;else throw f.createUIError("\u672A\u67E5\u8BE2\u5230\u8D26\u53F7")}else throw f.createUIError("\u6CA1\u6709\u4F20\u5165\u6709\u6548\u8D26\u53F7id")}catch(r){throw a.userName="",a.password="",r}}async function t(){if(w(a.userName))throw f.createUIError("\u8BF7\u8F93\u5165\u7528\u6237\u540D");if(w(a.password))throw f.createUIError("\u8BF7\u8F93\u5165\u5BC6\u7801");try{await B({account:F(a)})}catch(r){throw r}}return{account:a,fetchAccount:e,updateAccount:t}}const E="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!@#".split("");function k(a){const e=[],t=E.length;for(let r=0;r<a;++r){const d=Math.floor(Math.random()*t);e.push(E[d])}return e.join("")}var D=b({name:"AccountEdit",props:{id:{type:Number,required:!0},siteId:{type:Number,required:!0}},emits:["confirm","cancel"],setup(a,{emit:e}){const{account:t,fetchAccount:r,updateAccount:d}=x(),s=n(!1),l=n(null),c={userName:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"}]};function I(){l.value&&(s.value=!0,l.value.validate(i=>{i?d().then(()=>{e("confirm")}).catch(A=>{h.error(A.message)}).finally(()=>{s.value=!1}):s.value=!1}))}function v(){e("cancel")}N(()=>{t.id=a.id,t.siteId=a.siteId,t.id>0&&r().catch(i=>{h.error(i.message)})});function C(){t.password=k(10)}return()=>o(u("ElForm"),{model:t,ref:l,rules:c,labelPosition:"right",labelWidth:"90px"},{default:()=>[o(u("ElFormItem"),{label:"\u7528\u6237\u540D",prop:"userName"},{default:()=>[o(u("ElInput"),{modelValue:t.userName,["onUpdate:modelValue"]:i=>t.userName=i},null)]}),o(u("ElFormItem"),{label:"\u5BC6\u7801",prop:"password"},{default:()=>[o(u("ElInput"),{modelValue:t.password,["onUpdate:modelValue"]:i=>t.password=i},null)]}),o(u("ElFormItem"),null,{default:()=>[o(u("ElButton"),{onClick:C},{default:()=>[g("\u751F\u6210\u5BC6\u7801")]}),o(u("ElButton"),{type:"primary",onClick:I,loading:s.value},{default:()=>[g("\u63D0\u4EA4")]}),o(u("ElButton"),{onClick:v},{default:()=>[g("\u53D6\u6D88")]})]})]})}}),M=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:D});export{D as A,L as a,M as i};
//# sourceMappingURL=index.f3e58046.js.map
