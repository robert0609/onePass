import{a as v,A as g,U as f}from"./index.3fab5041.js";import{f as u,i as p,$ as F,a0 as I,d as b,W as B,F as h,c as n,Z as s,Y as C,a as w}from"./vendor.bb182ad9.js";async function U(a){var t;const e=await v.get("/webapi/search",a);if(!e.data.isSuccess)throw g.createApiError(e.data.message?e.data.message:(t=e.data.errorCode)==null?void 0:t.toString());return e.data}async function A(a){var t;const e=await v.get("/webapi/site/fetch",a);if(!e.data.isSuccess)throw g.createApiError(e.data.message?e.data.message:(t=e.data.errorCode)==null?void 0:t.toString());return e.data}async function S(a){var t;const e=await v.get("/webapi/site/fetch",a);if(!e.data.isSuccess)throw g.createApiError(e.data.message?e.data.message:(t=e.data.errorCode)==null?void 0:t.toString());return e.data}async function V(a){var r;const e=a.site,t=await v.post("/webapi/site/save",{site:JSON.stringify({Id:e.id,Name:encodeURIComponent(e.name),Url:e.url,Level:e.level})});if(!t.data.isSuccess)throw g.createApiError(t.data.message?t.data.message:(r=t.data.errorCode)==null?void 0:r.toString());return t.data}function N(){const a=u(0),e=u(""),t=u(""),r=u([]),m=u(0),o=u(0),c=u(1),d=u(0);async function E(){try{if(a.value>0){const l=await S({id:a.value});r.value=l.data,o.value=l.data.length,d.value=l.data.length}else if(p(e.value)){if(p(t.value))throw f.createUIError("\u8BF7\u8BBE\u7F6E\u7B5B\u9009\u6761\u4EF6");{const l=await U({keyword:t.value,withaccount:!1});r.value=l.data,o.value=l.data.length,d.value=l.data.length}}else{const l=await A({level:e.value});r.value=l.data,o.value=l.data.length,d.value=l.data.length}}catch(l){throw r.value=[],m.value=0,o.value=0,d.value=0,l}}return{id:a,level:e,keyword:t,siteList:r,currentPageIndex:m,pageSize:o,totalPageCount:c,totalCount:d,fetchSiteList:E}}function x(){const a=F({id:0,name:"",url:"",level:""});async function e(){try{if(a.id>0){const r=await S({id:a.id});if(r.data.length>0)a.name=r.data[0].name,a.url=r.data[0].url,a.level=r.data[0].level;else throw f.createUIError("\u672A\u67E5\u8BE2\u5230\u7F51\u7AD9")}else throw f.createUIError("\u8BF7\u8BBE\u7F6E\u7F51\u7AD9id")}catch(r){throw a.name="",a.url="",a.level="",r}}async function t(){if(p(a.name))throw f.createUIError("\u8BF7\u8F93\u5165\u5E94\u7528\u540D\u79F0");if(a.level=a.level.toString(),p(a.level))throw f.createUIError("\u8BF7\u8F93\u5165\u5E94\u7528\u7EA7\u522B");try{await V({site:I(a)})}catch(r){throw r}}return{site:a,fetchSite:e,updateSite:t}}var L=b({name:"SiteEdit",props:{id:{type:Number,required:!0},level:{type:String,required:!0}},emits:["confirm","cancel"],setup(a,{emit:e}){const{site:t,fetchSite:r,updateSite:m}=x(),o=u(!1),c=u(null),d={name:[{required:!0,message:"\u8BF7\u8F93\u5165\u5E94\u7528\u540D\u79F0",trigger:"blur"}]};function E(){c.value&&(o.value=!0,c.value.validate(i=>{i?m().then(()=>{e("confirm")}).catch(y=>{h.error(y.message)}).finally(()=>{o.value=!1}):o.value=!1}))}function l(){e("cancel")}return B(()=>{t.id=a.id,t.level=a.level,t.id>0&&r().catch(i=>{h.error(i.message)})}),()=>n(s("ElForm"),{model:t,ref:c,rules:d,labelPosition:"right",labelWidth:"90px"},{default:()=>[n(s("ElFormItem"),{label:"\u5E94\u7528\u540D\u79F0",prop:"name"},{default:()=>[n(s("ElInput"),{modelValue:t.name,["onUpdate:modelValue"]:i=>t.name=i},null)]}),n(s("ElFormItem"),{label:"\u5E94\u7528\u5730\u5740",prop:"url"},{default:()=>[n(s("ElInput"),{modelValue:t.url,["onUpdate:modelValue"]:i=>t.url=i},null)]}),n(s("ElFormItem"),{label:"\u5E94\u7528\u7EA7\u522B",prop:"level"},{default:()=>[n(s("ElInput"),C({readonly:!0},{modelValue:t.level,["onUpdate:modelValue"]:i=>t.level=i}),null)]}),n(s("ElFormItem"),null,{default:()=>[n(s("ElButton"),{type:"primary",onClick:E,loading:o.value},{default:()=>[w("\u63D0\u4EA4")]}),n(s("ElButton"),{onClick:l},{default:()=>[w("\u53D6\u6D88")]})]})]})}}),j=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:L});export{L as S,j as i,N as s};
//# sourceMappingURL=index.0c307f3a.js.map
