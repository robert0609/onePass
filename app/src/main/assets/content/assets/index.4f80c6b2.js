import{a as m,A as p,U as f}from"./index.613def92.js";import{f as c,$ as F,i as w,a0 as b,d as N,W as S,G as U,F as h,c as s,Z as u,a as g,Y as B}from"./vendor.bb182ad9.js";async function x(a){var t;const e=await m.get("/webapi/account/fetch",{siteid:a.siteId});if(!e.data.isSuccess)throw p.createApiError(e.data.message?e.data.message:(t=e.data.errorCode)==null?void 0:t.toString());return e.data}async function k(a){var t;const e=await m.get("/webapi/account/fetch",a);if(!e.data.isSuccess)throw p.createApiError(e.data.message?e.data.message:(t=e.data.errorCode)==null?void 0:t.toString());return e.data}async function D(a){var r;const e=a.account,t=await m.get("/webapi/account/save",{account:JSON.stringify({Id:e.id,SiteId:e.siteId,UserName:encodeURIComponent(e.userName),Password:e.password})});if(!t.data.isSuccess)throw p.createApiError(t.data.message?t.data.message:(r=t.data.errorCode)==null?void 0:r.toString());return t.data}function q(){const a=c(0),e=c([]),t=c(0),r=c(0),d=c(1),n=c(0);async function l(){try{if(a.value>0){const o=await x({siteId:a.value});e.value=o.data,r.value=o.data.length,n.value=o.data.length}else throw f.createUIError("\u6CA1\u6709\u4F20\u5165\u5E94\u7528\u7F16\u53F7\u6761\u4EF6")}catch(o){throw e.value=[],t.value=0,r.value=0,n.value=0,o}}return{siteId:a,accountList:e,currentPageIndex:t,pageSize:r,totalPageCount:d,totalCount:n,fetchAccountList:l}}function L(){const a=F({id:0,siteId:0,userName:"",password:""});async function e(){try{if(a.id>0){const r=await k({id:a.id});if(r.data.length>0)a.siteId=r.data[0].siteId,a.userName=r.data[0].userName,a.password=r.data[0].password;else throw f.createUIError("\u672A\u67E5\u8BE2\u5230\u8D26\u53F7")}else throw f.createUIError("\u6CA1\u6709\u4F20\u5165\u6709\u6548\u8D26\u53F7id")}catch(r){throw a.userName="",a.password="",r}}async function t(){if(w(a.userName))throw f.createUIError("\u8BF7\u8F93\u5165\u7528\u6237\u540D");if(w(a.password))throw f.createUIError("\u8BF7\u8F93\u5165\u5BC6\u7801");try{await D({account:b(a)})}catch(r){throw r}}return{account:a,fetchAccount:e,updateAccount:t}}const E="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz!@#".split("");function P(a){const e=[],t=E.length;for(let r=0;r<a;++r){const d=Math.floor(Math.random()*t);e.push(E[d])}return e.join("")}var V=N({name:"AccountEdit",props:{id:{type:Number,required:!0},siteId:{type:Number,required:!0}},emits:["confirm","cancel"],setup(a,{emit:e}){const{account:t,fetchAccount:r,updateAccount:d}=L(),n=c(!1),l=c(null);let o;const I={userName:[{required:!0,message:"\u8BF7\u8F93\u5165\u7528\u6237\u540D",trigger:"blur"}],password:[{required:!0,message:"\u8BF7\u8F93\u5165\u5BC6\u7801",trigger:"blur"}]};function v(){l.value&&(n.value=!0,l.value.validate(i=>{i?d().then(()=>{e("confirm")}).catch(A=>{h.error(A.message)}).finally(()=>{n.value=!1}):n.value=!1}))}function C(){e("cancel")}S(()=>{t.id=a.id,t.siteId=a.siteId,t.id>0&&(o=U.service({target:"#edit-form"}),r().catch(i=>{h.error(i.message)}).finally(()=>{o&&o.close()}))});function y(){t.password=P(10)}return()=>s(u("ElForm"),B({model:t,ref:l,rules:I,labelPosition:"right",labelWidth:"90px"},{id:"edit-form"}),{default:()=>[s(u("ElFormItem"),{label:"\u7528\u6237\u540D",prop:"userName"},{default:()=>[s(u("ElInput"),{modelValue:t.userName,["onUpdate:modelValue"]:i=>t.userName=i},null)]}),s(u("ElFormItem"),{label:"\u5BC6\u7801",prop:"password"},{default:()=>[s(u("ElInput"),{modelValue:t.password,["onUpdate:modelValue"]:i=>t.password=i},null)]}),s(u("ElFormItem"),null,{default:()=>[s(u("ElButton"),{onClick:y},{default:()=>[g("\u751F\u6210\u5BC6\u7801")]}),s(u("ElButton"),{type:"primary",onClick:v,loading:n.value},{default:()=>[g("\u63D0\u4EA4")]}),s(u("ElButton"),{onClick:C},{default:()=>[g("\u53D6\u6D88")]})]})]})}}),R=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:V});export{V as A,q as a,R as i};
//# sourceMappingURL=index.4f80c6b2.js.map
